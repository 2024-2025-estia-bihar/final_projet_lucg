AUTOTUNE = tf.data.AUTOTUNE
train_ds = (
    tf.data.Dataset.zip(
        (
            tf.data.Dataset.from_tensor_slices(train_df["Processed_Caption"]).map(
                tokenize_text
            ),
            tf.data.Dataset.from_tensor_slices(train_df["ImageURL"]).map(load_image),
            tf.data.Dataset.from_tensor_slices(
                process_labels(train_df.iloc[:, 3:21].values)
            ),
            tf.data.Dataset.from_tensor_slices(
                sample_weights
            ),  # Add sample weights to dataset
        )
    )
    .batch(32)
    .prefetch(1)
)

val_ds = (
    tf.data.Dataset.zip(
        (
            tf.data.Dataset.from_tensor_slices(val_df["Processed_Caption"]).map(
                tokenize_text
            ),
            tf.data.Dataset.from_tensor_slices(val_df["ImageURL"]).map(load_image),
            tf.data.Dataset.from_tensor_slices(
                process_labels(val_df.iloc[:, 3:21].values)
            ),  # Assuming labels are in columns 1 to n
        )
    )
    .batch(32)
    .prefetch(1)
)

test_ds = (
    tf.data.Dataset.zip(
        (
            tf.data.Dataset.from_tensor_slices(test_df["Processed_Caption"]).map(
                tokenize_text
            ),
            tf.data.Dataset.from_tensor_slices(test_df["ImageURL"]).map(load_image),
            tf.data.Dataset.from_tensor_slices(
                process_labels(test_df.iloc[:, 3:21].values)
            ),  # Assuming labels are in columns 1 to n
        )
    )
    .batch(32)
    .prefetch(1)
)